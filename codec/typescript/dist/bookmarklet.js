javascript:(()=>{var S="DCG",g=(c=>(c[c.ja=0]="ja",c[c.en=1]="en",c[c.zh=2]="zh",c[c.ko=3]="ko",c))(g||{});function x(r){return r.reduce(function(e,t){return e+t})&255}var D=new Map(Array.from({length:36},(r,e)=>{let t=e;return e>9&&(t=e+7),[e,String.fromCharCode(48+t)]})),I=new Map(Array.from(D,r=>[r[1],r[0]])),m=class r{number;parallel_id;count;constructor(e,t,n){this.number=e,this.parallel_id=t,this.count=n}toJSON(){let e={number:this.number,"parallel-id":this.parallel_id,count:this.count};return this.parallel_id==0&&delete e["parallel-id"],e}static fromJSON(e){return e instanceof String&&(e=JSON.parse(e)),new r(e.number,e["parallel-id"]??0,e.count)}},b=class r{digi_eggs;deck;sideboard;icon;language;name;constructor(e,t,n,c,i,a){this.digi_eggs=e,this.deck=t,this.sideboard=n,this.icon=c,this.language=i,this.name=a}toJSON(){let e={"digi-eggs":this.digi_eggs.map(t=>t instanceof m?t.toJSON():t),deck:this.deck.map(t=>t instanceof m?t.toJSON():t),sideboard:this?.sideboard?.map(t=>t instanceof m?t.toJSON():t)||[],icon:this.icon,language:this.language||g[1],name:this.name};return e?.sideboard?.length==0&&delete e.sideboard,e.icon||delete e.icon,e.language||delete e.language,e}static fromJSON(e){e instanceof String&&(e=JSON.parse(e));let t=e["digi-eggs"]??[],n=e.deck??[],c=e.sideboard??[],i=e.icon??null,a=e.language??g[1];return new r(t.map(o=>m.fromJSON(o)),n.map(o=>m.fromJSON(o)),c.map(o=>m.fromJSON(o)),i,a||g[1],e.name??"")}};async function q(r){return await new Promise((e,t)=>{let n=Object.assign(new FileReader,{onload:()=>{let c=n.result;e(c.substring(c.indexOf(",")+1))},onerror:()=>t(n.error)});n.readAsDataURL(new File([r],"",{type:"application/octet-stream"}))})}function k(r,e){let t=1<<e-1,n=r&t-1;return r>=t&&(n|=t),n}function A(r,e,t){let n=e>>t-1;for(;n>0;)r.push(k(n,8)),n=n>>7}function O(r){r.sort((t,n)=>t.number.localeCompare(n.number)||t.parallel_id-n.parallel_id);let e=Object.groupBy(r,({number:t})=>{let[n,c]=t.split("-");return[n,c.length].toString()});return Object.entries(e).map(([t,n])=>{let[c,i]=t.split(",");return[c,parseInt(i),n]})}async function J(r,e=5){let t=new Array,n=new TextEncoder,c=g[g[r.language]]??1,i=3<=e&&e<=4?e<<4|c<<3|r.digi_eggs.length&15:e<<4|r.digi_eggs.length&15;e>=4&&r.icon&&(r.name=r.icon.padEnd(8)+r.name);let a=n.encode(r.name);a=a.slice(0,63),r.name=new TextDecoder().decode(a);let o=a.length;e>=5&&(o=c<<6|o),t.push(i),t.push(0),t.push(o);let d=t.length;if(e>=2){let l=r?.sideboard?.length??0;e>=4&&r.icon&&(l|=128),t.push(l)}let s=new Array;s=s.concat(O(r?.digi_eggs??[])),s=s.concat(O(r?.deck??[])),s=s.concat(O(r?.sideboard??[]));for(let[l,N,h]of s){if(e==0)t=t.concat(Array.from(n.encode(l.padEnd(4," "))));else for(let u=0;u<l.length;u++){let y=l[u],p=I.get(y);l[parseInt(u.toString())+1]&&(p|=128),t.push(p)}e<2?t.push(N-1<<6|h.length):(t.push(N-1<<6|k(h.length,6)),A(t,h.length,6));let E=0;for(let u of h){let y=u.number.split("-")[1],p=y-E;e==0?(t.push(u.count-1<<6|u.parallel_id<<3|k(p,3)),A(t,p,3)):(t.push(u.count-1),t.push(u.parallel_id<<5|k(p,5)),A(t,p,5)),E=y}}t[1]=x(t.slice(d));for(let l of a)t.push(l);return S+(await q(new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function f(r,e=5){return J(b.fromJSON(r),e)}async function C(){return(await(await fetch("https://digimoncard.dev/data8675309.php")).json()).filter(({cardtype:t})=>t==1).map(({cardid:t})=>t)}async function U(){if(!location.pathname.match(/^\/deckbuilder\/(\S{36})$/))throw Error("Not on deck page");async function r(){let i=location.pathname.replace("/deckbuilder/",""),a=new FormData;return a.append("m","14"),a.append("pubKey",i),await(await fetch("https://digimoncard.dev/data8675309.php",{method:"POST",body:a})).json()}let e=await C(),t=await r(),n=JSON.parse(t[0].data).deck;n=n.reduce((i,a)=>(i[a]=(i[a]??0)+1,i),{}),n=Object.entries(n).map(([i,a])=>({number:i,count:a}));let c=Object.groupBy(n,({number:i})=>e.includes(i).toString());return{"digi-eggs":c.true,deck:c.false,name:t[0].description+" by "+t[0].displayName}}async function R(){if(!document.querySelector("#main_deck"))throw Error("Not on deck page");let r=Array.from(document.querySelectorAll("#egg_deck a")).map(a=>{let o=a.querySelector("img").dataset.card,d=parseInt(a.querySelector(".card-count").textContent.replace("x",""));return{number:o,count:d}}),e=Array.from(document.querySelectorAll("#main_deck a")).map(a=>{let o=a.querySelector("img").dataset.card,d=parseInt(a.querySelector(".card-count").textContent.replace("x",""));return{number:o,count:d}}),t=Array.from(document.querySelectorAll("#side_deck a")).map(a=>{let o=a.querySelector("img").dataset.card,d=parseInt(a.querySelector(".card-count").textContent.replace("x",""));return{number:o,count:d}}),n=document.querySelector(".deck-metadata-container h1").textContent,c=document.querySelector(".deck-metadata-container h1 ~ .deck-metadata-info").textContent.trim(),i=document.querySelector(".deck-metadata-container").style.cssText.match(/[A-Z0-9]+\-[0-9]+/)[0];return{"digi-eggs":r,deck:e,sideboard:t,name:n+" by "+c,icon:i}}async function M(){async function r(s){return await(await fetch(s)).json()}let e=location.pathname.match(/\/deckbuilder\/(.*)/);if(!e)throw Error("Not on deck page");let t="https://backend.digimoncard.app/api/decks/"+e[1],n=await r(t),c=await C(),i=JSON.parse(n.cards).map(({id:s,count:_})=>({number:s,count:_})),a=JSON.parse(n.sideDeck).map(({id:s,count:_})=>({number:s,count:_})),o=n.imageCardId,d=Object.groupBy(i,({number:s})=>c.includes(s).toString());return{"digi-eggs":d.true,deck:d.false,sideboard:a,icon:o,name:n.title+" by "+n.user}}async function P(){if(!document.querySelector("#media-gallery"))throw Error("Not on deck page");let r=Array.from(document.querySelectorAll("#media-gallery div")).filter(o=>o.textContent?.trim().startsWith('["Exported from digimonmeta.com",'))[0],e=document.querySelector("article .entry-content")?.textContent,t=e?.match(/Deck Name:(.*)Author/)[1].trim(),n=e?.match(/Author:(.*)Date/)[1].trim(),c=await C(),i=[];r=JSON.parse(r.textContent).slice(1).reduce((o,d)=>(o.set(d,(o.get(d)??0)+1),o),new Map).forEach((o,d,s)=>{i.push({number:d,count:o})});let a=Object.groupBy(i,({number:o})=>c.includes(o).toString());return{"digi-eggs":a.true,deck:a.false,name:t+" by "+n}}(async()=>{switch(location.hostname){case"digimoncard.dev":try{let r=await U(),e=await f(r);console.log(e)}catch(r){console.error("Uh oh... ",r)}break;case"digimoncard.io":try{let r=await R(),e=await f(r);console.log(e)}catch(r){console.error("Uh oh... ",r)}break;case"digimoncard.app":try{let r=await M(),e=await f(r);console.log(e)}catch(r){console.error("Uh oh... ",r)}break;case"digimonmeta.com":try{let r=await P(),e=await f(r);console.log(e)}catch(r){console.error("Uh oh... ",r)}break;default:console.error("Cannot detect deck")}})();})();
